<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Record
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Record";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (R)</a> &raquo;
    
    
    <span class="title">Record</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Record
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Sequel::Model</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sequel::Model</li>
          
            <li class="next">Record</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="DOIHelpers.html" title="DOIHelpers (module)">DOIHelpers</a></span>, <span class='object_link'><a href="ReferenceMethods.html" title="ReferenceMethods (module)">ReferenceMethods</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>model/registro.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_doi-instance_method" title="#add_doi (instance method)">#<strong>add_doi</strong>(doi)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Result.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_doi_automatic-instance_method" title="#add_doi_automatic (instance method)">#<strong>add_doi_automatic</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Asigna un doi automaticamente desde crossref y verifica que el DOI del
canónico calce.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#crossref_query-instance_method" title="#crossref_query (instance method)">#<strong>crossref_query</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Obtener una Query Crossref.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#references-instance_method" title="#references (instance method)">#<strong>references</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#references_automatic_crossref-instance_method" title="#references_automatic_crossref (instance method)">#<strong>references_automatic_crossref</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#references_id-instance_method" title="#references_id (instance method)">#<strong>references_id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_references-instance_method" title="#update_references (instance method)">#<strong>update_references</strong>(references_id, modo = :aditivo)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="DOIHelpers.html" title="DOIHelpers (module)">DOIHelpers</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="DOIHelpers.html#a_doi-instance_method" title="DOIHelpers#a_doi (method)">#a_doi</a></span>, <span class='object_link'><a href="DOIHelpers.html#doi_without_http-instance_method" title="DOIHelpers#doi_without_http (method)">#doi_without_http</a></span>, <span class='object_link'><a href="DOIHelpers.html#find_doi-instance_method" title="DOIHelpers#find_doi (method)">#find_doi</a></span>, <span class='object_link'><a href="DOIHelpers.html#url_doi-instance_method" title="DOIHelpers#url_doi (method)">#url_doi</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="ReferenceMethods.html" title="ReferenceMethods (module)">ReferenceMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ReferenceMethods.html#authors_apa_6-instance_method" title="ReferenceMethods#authors_apa_6 (method)">#authors_apa_6</a></span>, <span class='object_link'><a href="ReferenceMethods.html#cite_apa_6-instance_method" title="ReferenceMethods#cite_apa_6 (method)">#cite_apa_6</a></span>, <span class='object_link'><a href="ReferenceMethods.html#ref_apa_6-instance_method" title="ReferenceMethods#ref_apa_6 (method)">#ref_apa_6</a></span>, <span class='object_link'><a href="ReferenceMethods.html#ref_apa_6_brief-instance_method" title="ReferenceMethods#ref_apa_6_brief (method)">#ref_apa_6_brief</a></span>, <span class='object_link'><a href="ReferenceMethods.html#ref_apa_6_brief_html-instance_method" title="ReferenceMethods#ref_apa_6_brief_html (method)">#ref_apa_6_brief_html</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_doi-instance_method">
  
    #<strong>add_doi</strong>(doi)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns Result</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>doi</span>
      
      
        <span class='type'></span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>Result</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model/registro.rb', line 111</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_status'>status</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_crossref_doi'>crossref_doi</span><span class='op'>=</span><span class='const'>CrossrefDoi</span><span class='period'>.</span><span class='id identifier rubyid_procesar_doi'>procesar_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_crossref_doi'>crossref_doi</span>
    <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>record.cant_process_doi</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>doi:</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_status'>status</span>
  <span class='kw'>end</span>

  <span class='comment'>##$log.info(co)
</span>  <span class='kw'>if</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='op'>==</span><span class='id identifier rubyid_doi'>doi</span>
    <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>record.already_added_doi</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>doi:</span><span class='id identifier rubyid_doi'>doi</span><span class='comma'>,</span> <span class='label'>record_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='id identifier rubyid_doi_without_http'>doi_without_http</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Se agrega DOI </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_doi'>doi</span><span class='embexpr_end'>}</span><span class='tstring_content'> para registro </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Verificamos si el canónico calza con el original
</span>  <span class='id identifier rubyid_can_doc_original'>can_doc_original</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:canonical_document_id</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_can_doc_doi'>can_doc_doi</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='id identifier rubyid_doi_without_http'>doi_without_http</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_can_doc_original'>can_doc_original</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='op'>==</span><span class='id identifier rubyid_doi_without_http'>doi_without_http</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>record.already_added_doi_on_cd</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>doi:</span><span class='id identifier rubyid_doi'>doi</span><span class='comma'>,</span> <span class='label'>cd_title:</span><span class='id identifier rubyid_can_doc_original'>can_doc_original</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_can_doc_doi'>can_doc_doi</span> <span class='comment'># No hay ningún doc previo con este problema
</span>    <span class='id identifier rubyid_can_doc_original'>can_doc_original</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='id identifier rubyid_doi_without_http'>doi_without_http</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>record.assigned_doi_to_cd</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='label'>doi:</span><span class='id identifier rubyid_doi'>doi</span><span class='comma'>,</span> <span class='label'>cd_title:</span><span class='id identifier rubyid_can_doc_original'>can_doc_original</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>else</span>  <span class='comment'># Ok, tenemos un problema. No lo podemos resolver ahora, sólo podemos avisar en el canónico
</span>    <span class='id identifier rubyid_can_doc_original'>can_doc_original</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='id identifier rubyid_doi_without_http'>doi_without_http</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='comma'>,</span><span class='symbol'>:duplicated</span><span class='op'>=&gt;</span><span class='id identifier rubyid_can_doc_doi'>can_doc_doi</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Se agregó a canónico </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_can_doc_original'>can_doc_original</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> el DOI, pero existe un duplicado (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_can_doc_doi'>can_doc_doi</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>). Revisar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_status'>status</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_doi_automatic-instance_method">
  
    #<strong>add_doi_automatic</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Asigna un doi automaticamente desde crossref y verifica que el DOI del
canónico calce</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model/registro.rb', line 41</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_doi_automatic'>add_doi_automatic</span>
  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_query'>query</span><span class='op'>=</span><span class='id identifier rubyid_crossref_query'>crossref_query</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_query'>query</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>score</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&gt;</span><span class='int'>100</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>doi</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Assigned_DOI_to_record</span><span class='comma'>,</span> <span class='label'>record_id:</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>author:</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:author</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>doi:</span><span class='id identifier rubyid_query'>query</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>doi</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:DOI_not_assigned_to_record</span><span class='comma'>,</span> <span class='label'>record_id:</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>author:</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:author</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

  <span class='kw'>elsif</span> <span class='id identifier rubyid_canonical_document'>canonical_document</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_canonical_document'>canonical_document</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='op'>!=</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DOI para canonico </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_canonical_document'>canonical_document</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>  y reference </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> -&gt; </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> difieren</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>record.doi_already_added_to</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>record_title:</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="crossref_query-instance_method">
  
    #<strong>crossref_query</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Obtener una Query Crossref. Se utiliza el APA 6</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model/registro.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_crossref_query'>crossref_query</span>
  <span class='const'><span class='object_link'><a href="CrossrefQuery.html" title="CrossrefQuery (class)">CrossrefQuery</a></span></span><span class='period'>.</span><span class='id identifier rubyid_generar_query_desde_text'><span class='object_link'><a href="CrossrefQuery.html#generar_query_desde_text-class_method" title="CrossrefQuery.generar_query_desde_text (method)">generar_query_desde_text</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_ref_apa_6'>ref_apa_6</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="references-instance_method">
  
    #<strong>references</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model/registro.rb', line 148</span>

<span class='kw'>def</span> <span class='id identifier rubyid_references'>references</span>
  <span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_references_id'>references_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="references_automatic_crossref-instance_method">
  
    #<strong>references_automatic_crossref</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model/registro.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_references_automatic_crossref'>references_automatic_crossref</span>
  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_ri_json'>ri_json</span><span class='op'>=</span><span class='const'>CrossrefDoi</span><span class='period'>.</span><span class='id identifier rubyid_reference_integrator_json'>reference_integrator_json</span><span class='lparen'>(</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ri_json'>ri_json</span> <span class='kw'>and</span> <span class='id identifier rubyid_ri_json'>ri_json</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span>

    <span class='id identifier rubyid_ref_ids'>ref_ids</span><span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_ri_json'>ri_json</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_reference'>reference</span><span class='op'>|</span>
      <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='id identifier rubyid_reference'>reference</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span>
      <span class='id identifier rubyid_text'>text</span><span class='op'>=</span><span class='id identifier rubyid_reference'>reference</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='id identifier rubyid_ref'>ref</span><span class='op'>=</span><span class='const'>Reference</span><span class='period'>.</span><span class='id identifier rubyid_get_by_text_and_doi'>get_by_text_and_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span><span class='id identifier rubyid_doi'>doi</span><span class='comma'>,</span><span class='kw'>true</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_doi'>doi</span>
        <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='id identifier rubyid_doi_without_http'>doi_without_http</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cd'>cd</span> <span class='kw'>and</span> <span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_canonical_document_id'>canonical_document_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_ref_ids'>ref_ids</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_update_references'>update_references</span><span class='lparen'>(</span><span class='id identifier rubyid_ref_ids'>ref_ids</span><span class='comma'>,</span><span class='symbol'>:aditivo</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>record.references_for_crossref_processed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>n:</span><span class='id identifier rubyid_ri_json'>ri_json</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>record.no_references_on_crossref</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="references_id-instance_method">
  
    #<strong>references_id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model/registro.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_references_id'>references_id</span>
  <span class='gvar'>$db</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT reference_id FROM records_references rr WHERE record_id=?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_select_map'>select_map</span><span class='lparen'>(</span><span class='symbol'>:reference_id</span><span class='rparen'>)</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_references-instance_method">
  
    #<strong>update_references</strong>(references_id, modo = :aditivo)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>references_id</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID de references que deberían estar acá</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model/registro.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_references'>update_references</span><span class='lparen'>(</span><span class='id identifier rubyid_references_id'>references_id</span><span class='comma'>,</span> <span class='id identifier rubyid_modo'>modo</span><span class='op'>=</span><span class='symbol'>:aditivo</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_cit_ref_yap'>cit_ref_yap</span><span class='op'>=</span><span class='gvar'>$db</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT reference_id FROM records_references WHERE record_id=?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:reference_id</span><span class='rbracket'>]</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_cit_rep_por_ingresar'>cit_rep_por_ingresar</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_references_id'>references_id</span><span class='op'>-</span> <span class='id identifier rubyid_cit_ref_yap'>cit_ref_yap</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
  <span class='id identifier rubyid_cit_rep_por_borrar'>cit_rep_por_borrar</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_cit_ref_yap'>cit_ref_yap</span> <span class='op'>-</span> <span class='id identifier rubyid_references_id'>references_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_cit_rep_por_ingresar'>cit_rep_por_ingresar</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>&gt;</span><span class='int'>0</span>
      <span class='gvar'>$db</span><span class='lbracket'>[</span><span class='symbol'>:records_references</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_multi_insert'>multi_insert</span><span class='lparen'>(</span><span class='id identifier rubyid_cit_rep_por_ingresar'>cit_rep_por_ingresar</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='lbrace'>{</span><span class='symbol'>:reference_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='symbol'>:record_id</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span> <span class='op'>::</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Added_references_to_record</span><span class='comma'>,</span> <span class='symbol'>:record_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:count_references</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cit_rep_por_ingresar'>cit_rep_por_ingresar</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_cit_rep_por_borrar'>cit_rep_por_borrar</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>&gt;</span><span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_modo'>modo</span><span class='op'>==</span><span class='symbol'>:sincronia</span>
      <span class='gvar'>$db</span><span class='lbracket'>[</span><span class='symbol'>:records_references</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:record_id</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:reference_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cit_rep_por_borrar'>cit_rep_por_borrar</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span> <span class='op'>::</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Deleted_references_to_record</span><span class='comma'>,</span> <span class='symbol'>:record_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:count_references</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cit_rep_por_borrar'>cit_rep_por_borrar</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Mar  3 02:48:41 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.4.1).
</div>

    </div>
  </body>
</html>